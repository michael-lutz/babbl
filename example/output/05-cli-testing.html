<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name=title content=CLI Testing>
<meta name=author content=Test User>
<meta name=date content=2025-01-02>
<meta name=description content=Testing CLI functionality and edge cases>
<title>CLI Testing</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
    line-height: 1.6;
    max-width: 750px;
    margin: 0 auto;
    padding: 1.5rem;
    color: #333;
    background-color: #fff;
}

section {
    padding: 0;
}

.title {
    font-size: 2.0rem;
    margin-top: 1.0rem;
    margin-bottom: 0.0rem;
    color: #333;
    font-weight: 600;
}

.heading-1 { 
    font-size: 1.6rem; 
    margin-top: 1.0rem; 
    margin-bottom: 0.5rem; 
    color: #333;
    font-weight: 600;
}

.heading-2 { 
    font-size: 1.4rem; 
    margin-top: 1rem; 
    margin-bottom: 0.5rem; 
    color: #333;
    font-weight: 600;
}

.heading-3 { 
    font-size: 1.2rem; 
    margin-top: 1.0rem; 
    margin-bottom: 0.5rem; 
    color: #333;
    font-weight: 600;
}

.heading-4, .heading-5, .heading-6 { 
    font-size: 1rem; 
    margin-top: 1rem; 
    margin-bottom: 0.5rem; 
    color: #333;
    font-weight: 600;
}

.paragraph { 
    margin-bottom: 1rem; 
    text-align: left;
    font-size: .9rem;
}

.code-block { 
    background: #f5f5f5; 
    padding: 1rem; 
    border: none;
    overflow-x: auto;
    margin: 0;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    font-size: 0.75rem;
    line-height: 1.4;
    color: #333;
}

.inline-code { 
    background: #f5f5f5; 
    padding: 0.15rem 0.3rem; 
    border: none;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    font-size: 0.75rem;
    color: #333;
}

.link { 
    color: #0066cc; 
    text-decoration: none; 
}

.link:hover { 
    text-decoration: underline;
}

.image { 
    max-width: 100%; 
    height: auto; 
    margin: 1rem 0; 
    border: none;
}

.unordered-list, .ordered-list { 
    margin: 1rem 0; 
    padding-left: 2rem; 
}

.list-item { 
    margin-bottom: 0.5rem; 
    line-height: 1.6;
    font-size: .9rem;
}

.blockquote { 
    border-left: 3px solid #ddd; 
    padding-left: 1rem; 
    margin: 0.5rem 0; 
    font-style: italic;
    color: #666;
    background: none;
    padding: 0.25rem 0.5rem;
    font-size: 0.9rem;
}

.strong { 
    font-weight: 600; 
    color: #333;
}

.emphasis { 
    font-style: italic; 
    color: #333;
}

.metadata {
    font-size: 0.8rem;
    color: #666;
    margin-top: 0.5rem;
    margin-bottom: 1rem;
}

.meta-field {
    margin-bottom: 0.25rem;
    line-height: 1.2rem;
}

.meta-field:last-child {
    margin-bottom: 0;
}

hr {
    border: none;
    height: 1px;
    background: #ddd;
    margin: 1.5rem 0;
}

/* Table Styles */
.table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
    font-size: 0.9rem;
    background: #fff;
    border: 1px solid #ddd;
}

.table th {
    background: #f8f9fa;
    border: 1px solid #ddd;
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    color: #333;
}

.table td {
    border: 1px solid #ddd;
    padding: 0.75rem;
    text-align: left;
    vertical-align: top;
}

.table tr:nth-child(even) {
    background: #f8f9fa;
}

.table tr:hover {
    background: #f1f3f4;
}

.table-container {
    overflow-x: auto;
    margin: 1rem 0;
}

.container {
    position: relative;
    max-width: 750px;
    margin: 0 auto;
}

.toc {
    position: fixed;
    top: 11.75rem;
    left: calc(50% - 625px);
    width: 200px;
    max-height: calc(100vh - 8rem);
    overflow-y: auto;
}

.toc-nav {
    margin: 0;
}

.toc-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #ddd;
}

.toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.toc-list li {
    margin-bottom: 0.75rem;
}

.toc-link {
    display: block;
    padding: 0.25rem 0;
    color: #666;
    text-decoration: none;
    font-size: 0.85rem;
    line-height: 1.4;
    text-align: right;
    transition: color 0.2s ease;
}

.toc-link:hover {
    color: #0066cc;
    text-decoration: none;
}

.content {
    width: 100%;
}

/* Code Reference Styles */
.code-reference {
    margin: 1rem 0;
    border: 1px solid #ddd;
    border-radius: 6px;
    overflow: hidden;
    background: #fff;
}

.code-ref-header {
    background: #f8f9fa;
    padding: 0.75rem .9rem;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.2s ease;
}

.code-ref-header:hover {
    background: #e9ecef;
}

.code-ref-title {
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    font-size: 0.75rem;
    color: #495057;
    font-weight: 500;
}

.code-ref-toggle {
    font-size: 0.75rem;
    color: #6c757d;
    transition: transform 0.2s ease;
}

.code-ref-content {
    display: none;
    padding: 0;
    background: #fff;
}

.code-ref-content.show {
    display: block;
}

.code-ref-error {
    background: #f8d7da;
    color: #721c24;
    padding: 0.75rem 1rem;
    border: 1px solid #f5c6cb;
    border-radius: 6px;
    font-size: 0.75rem;
    margin: 1rem 0;
}

/* HTML Inclusion Styles */
.html-inclusion {
    margin: 1rem 0;
    border: none;
    border-radius: 0;
    overflow: auto;
    background: transparent;
    padding: 0;
}

/* Math Styles */
.math-inline {
    display: inline;
    font-family: 'Times New Roman', Times, serif;
}

.math-display {
    display: block;
    text-align: center;
    margin: 1rem 0;
    font-family: 'Times New Roman', Times, serif;
}

/* MathML styling */
math {
    font-family: 'Times New Roman', Times, serif;
}

/* Responsive design for mobile */
@media (max-width: 768px) {
    .toc {
        position: static;
        width: auto;
        max-height: none;
        margin-bottom: 1rem;
    }
    
    body {
        padding: 1rem;
    }
}

pre { line-height: 125%; }
td.linenos .normal { color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #f0f0f0; }
.highlight .c { color: #60A0B0; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #F00 } /* Error */
.highlight .k { color: #007020; font-weight: bold } /* Keyword */
.highlight .o { color: #666 } /* Operator */
.highlight .ch { color: #60A0B0; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #60A0B0; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #007020 } /* Comment.Preproc */
.highlight .cpf { color: #60A0B0; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #60A0B0; font-style: italic } /* Comment.Single */
.highlight .cs { color: #60A0B0; background-color: #FFF0F0 } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight .gr { color: #F00 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888 } /* Generic.Output */
.highlight .gp { color: #C65D09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #04D } /* Generic.Traceback */
.highlight .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #007020 } /* Keyword.Pseudo */
.highlight .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #902000 } /* Keyword.Type */
.highlight .m { color: #40A070 } /* Literal.Number */
.highlight .s { color: #4070A0 } /* Literal.String */
.highlight .na { color: #4070A0 } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #0E84B5; font-weight: bold } /* Name.Class */
.highlight .no { color: #60ADD5 } /* Name.Constant */
.highlight .nd { color: #555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #D55537; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #007020 } /* Name.Exception */
.highlight .nf { color: #06287E } /* Name.Function */
.highlight .nl { color: #002070; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0E84B5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #062873; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #BB60D5 } /* Name.Variable */
.highlight .ow { color: #007020; font-weight: bold } /* Operator.Word */
.highlight .w { color: #BBB } /* Text.Whitespace */
.highlight .mb { color: #40A070 } /* Literal.Number.Bin */
.highlight .mf { color: #40A070 } /* Literal.Number.Float */
.highlight .mh { color: #40A070 } /* Literal.Number.Hex */
.highlight .mi { color: #40A070 } /* Literal.Number.Integer */
.highlight .mo { color: #40A070 } /* Literal.Number.Oct */
.highlight .sa { color: #4070A0 } /* Literal.String.Affix */
.highlight .sb { color: #4070A0 } /* Literal.String.Backtick */
.highlight .sc { color: #4070A0 } /* Literal.String.Char */
.highlight .dl { color: #4070A0 } /* Literal.String.Delimiter */
.highlight .sd { color: #4070A0; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #4070A0 } /* Literal.String.Double */
.highlight .se { color: #4070A0; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #4070A0 } /* Literal.String.Heredoc */
.highlight .si { color: #70A0D0; font-style: italic } /* Literal.String.Interpol */
.highlight .sx { color: #C65D09 } /* Literal.String.Other */
.highlight .sr { color: #235388 } /* Literal.String.Regex */
.highlight .s1 { color: #4070A0 } /* Literal.String.Single */
.highlight .ss { color: #517918 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #06287E } /* Name.Function.Magic */
.highlight .vc { color: #BB60D5 } /* Name.Variable.Class */
.highlight .vg { color: #BB60D5 } /* Name.Variable.Global */
.highlight .vi { color: #BB60D5 } /* Name.Variable.Instance */
.highlight .vm { color: #BB60D5 } /* Name.Variable.Magic */
.highlight .il { color: #40A070 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<div class="container">

<main class="content">
<section>
<header>
<h1 class="title">CLI Testing</h1>
<div class='metadata'>
<div class="meta-field">Author: Test User</div>
<div class="meta-field">Date: 2025-01-02</div>
<div class="meta-field">Description: Testing CLI functionality and edge cases</div>
</div>
<hr />
</header>

<h1 id="cli-testing" class="heading-1">CLI Testing</h1>
<p class="paragraph">This document tests various CLI scenarios and edge cases.</p>
<h2 id="basic-rendering" class="heading-2">Basic Rendering</h2>
<p class="paragraph">This document should render correctly with the basic <code class="inline-code">babbl render</code> command.</p>
<h2 id="file-paths" class="heading-2">File Paths</h2>
<p class="paragraph">Testing various file path scenarios:</p>
<ul class="unordered-list">
<li class="list-item">Relative paths: <code class="inline-code">babbl render example/05-cli-testing.md</code></li>
<li class="list-item">Absolute paths: <code class="inline-code">babbl render /full/path/to/file.md</code></li>
<li class="list-item">Output specification: <code class="inline-code">babbl render input.md -o output.html</code></li>
</ul>
<h2 id="css-customization" class="heading-2">CSS Customization</h2>
<p class="paragraph">Test custom CSS with: <code class="inline-code">babbl render input.md --css custom.css</code></p>
<h2 id="table-of-contents" class="heading-2">Table of Contents</h2>
<p class="paragraph">Test TOC generation with: <code class="inline-code">babbl render input.md --toc</code></p>
<h2 id="code-reference-base-path" class="heading-2">Code Reference Base Path</h2>
<p class="paragraph">Test code references with custom base path: <code class="inline-code">babbl render input.md --base-path /path/to/project</code></p>
<h2 id="batch-processing" class="heading-2">Batch Processing</h2>
<p class="paragraph">Test batch processing with: <code class="inline-code">babbl build example/ --pattern &quot;*.md&quot;</code></p>
<h2 id="recursive-processing" class="heading-2">Recursive Processing</h2>
<p class="paragraph">Test recursive processing with: <code class="inline-code">babbl build example/ --recursive</code></p>
<h2 id="error-handling" class="heading-2">Error Handling</h2>
<p class="paragraph">This document tests various error scenarios:</p>
<h3 id="invalid-code-references" class="heading-3">Invalid Code References</h3>
<div class="code-ref-error">Code reference not found: ../nonexistent/file.py - function</div>
<h3 id="invalid-line-numbers" class="heading-3">Invalid Line Numbers</h3>
<div class="code-ref-error">Code reference not found: ../babbl/cli.py - line 999</div>
<h3 id="invalid-line-ranges" class="heading-3">Invalid Line Ranges</h3>
<div class="code-ref-error">Code reference not found: ../babbl/cli.py - lines 999-1000</div>
<h2 id="edge-cases" class="heading-2">Edge Cases</h2>
<h3 id="empty-code-blocks" class="heading-3">Empty Code Blocks</h3>
<pre class="code-block"><code>

</code></pre>
<h3 id="tables-with-irregular-data" class="heading-3">Tables with Irregular Data</h3>
<div class="table-container">
<table class="table">
<thead>
<tr>
<th>Col1</th>
<th>Col2</th>
<th>Col3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Data</td>
<td></td>
<td>More Data</td>
</tr>
<tr>
<td></td>
<td>Missing</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="mixed-content-types" class="heading-3">Mixed Content Types</h3>
<p class="paragraph">This paragraph contains <strong class="strong">bold</strong>, <em class="emphasis">italic</em>, <code class="inline-code">code</code>, and <a href="https://example.com" class="link">links</a>.</p>
<blockquote class="blockquote">
<p class="paragraph">Blockquote with <strong class="strong">formatting</strong> and <code class="inline-code">code</code>.</p>
</blockquote>
<ul class="unordered-list">
<li class="list-item">List with <strong class="strong">bold</strong> items</li>
<li class="list-item">List with <em class="emphasis">italic</em> items  </li>
<li class="list-item">List with <code class="inline-code">code</code> items</li>
</ul>
<h2 id="performance-testing" class="heading-2">Performance Testing</h2>
<p class="paragraph">This section contains a lot of content to test rendering performance:</p>
<p class="paragraph">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
<p class="paragraph">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<p class="paragraph">Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
<p class="paragraph">Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.</p>
<p class="paragraph">Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.</p>
<p class="paragraph">Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?</p>
<h2 id="code-references-in-lists" class="heading-2">Code References in Lists</h2>
<ul class="unordered-list">
<li class="list-item">Function: <a href="../babbl/cli.py#render" class="link">render</a></li>
<li class="list-item">Class: <a href="../babbl/renderer.py#HTMLRenderer" class="link">HTMLRenderer</a></li>
<li class="list-item">Method: <a href="../babbl/elements.py#parse_table_from_text" class="link">parse_table_from_text</a></li>
</ul>
<h2 id="tables-with-code-references" class="heading-2">Tables with Code References</h2>
<div class="table-container">
<table class="table">
<thead>
<tr>
<th>Component</th>
<th>File</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td>Parser</td>
<td>babbl/parser.py</td>
<td><div class="code-reference">
<div class="code-ref-header" onclick="toggleCodeRef('code-ref-0f3d6094')">
<span class="code-ref-title">../babbl/parser.py - BabblParser</span>
<span class="code-ref-toggle">▼</span>
</div>
<div class="code-ref-content" id="code-ref-0f3d6094">
<div class="highlight"><pre class="code-block"><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BabblParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom parser that includes table and code reference support.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Add table support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">Table</span><span class="p">)</span>
        <span class="c1"># Add code reference support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">CodeReference</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse text with table and code reference support.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

</div>
</div></td>
</tr>
<tr>
<td>Renderer</td>
<td>babbl/renderer.py</td>
<td><div class="code-reference">
<div class="code-ref-header" onclick="toggleCodeRef('code-ref-0c1cb1f2')">
<span class="code-ref-title">../babbl/renderer.py - HTMLRenderer</span>
<span class="code-ref-toggle">▼</span>
</div>
<div class="code-ref-content" id="code-ref-0c1cb1f2">
<div class="highlight"><pre class="code-block"><span></span><span class="k">class</span><span class="w"> </span><span class="nc">HTMLRenderer</span><span class="p">(</span><span class="n">BaseRenderer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Beautiful HTML renderer with clean styling and semantic classes.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">highlight_syntax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">css_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_toc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">base_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">current_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the HTML renderer.</span>

<span class="sd">        Args:</span>
<span class="sd">            highlight_syntax: Whether to use Pygments for syntax highlighting</span>
<span class="sd">            css_file_path: Path to CSS file</span>
<span class="sd">            show_toc: Whether to show table of contents for h1 headings</span>
<span class="sd">            base_path: Base path for resolving code reference file paths</span>
<span class="sd">            current_file_path: Path to the current markdown file being processed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_syntax</span> <span class="o">=</span> <span class="n">highlight_syntax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pygments_formatter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_toc</span> <span class="o">=</span> <span class="n">show_toc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toc_headings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># track h1 headings for toc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">=</span> <span class="n">base_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_file_path</span> <span class="o">=</span> <span class="n">current_file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span> <span class="o">=</span> <span class="n">output_file_path</span>

        <span class="k">if</span> <span class="n">css_file_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_css</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="n">css_file_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_css</span> <span class="o">=</span> <span class="n">DEFAULT_CSS</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight_syntax</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">pygments</span><span class="w"> </span><span class="kn">import</span> <span class="n">highlight</span>  <span class="c1"># type: ignore</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">pygments.formatters</span><span class="w"> </span><span class="kn">import</span> <span class="n">HtmlFormatter</span>  <span class="c1"># type: ignore</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">pygments.lexers</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_lexer_by_name</span>  <span class="c1"># type: ignore</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="n">highlight</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_by_name</span> <span class="o">=</span> <span class="n">get_lexer_by_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pygments_formatter</span> <span class="o">=</span> <span class="n">HtmlFormatter</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;friendly&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight_syntax</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_escape_html</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replaces unsafe HTML characters with their escaped equivalents.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">raw</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#x27;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_escape_html_preserve_mathml</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Escape HTML but preserve MathML tags.&quot;&quot;&quot;</span>
        <span class="n">mathml_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">placeholder_pattern</span> <span class="o">=</span> <span class="s2">&quot;###MATHML_PLACEHOLDER_</span><span class="si">{}</span><span class="s2">_###&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">replace_mathml</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="n">mathml_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">placeholder_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mathml_tags</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;math[^&gt;]*&gt;.*?&lt;/math&gt;&quot;</span><span class="p">,</span> <span class="n">replace_mathml</span><span class="p">,</span> <span class="n">raw</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">text</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#x27;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mathml_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mathml_tags</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">placeholder_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">mathml_tag</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_escape_url</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Escape urls to prevent code injection.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">raw</span><span class="p">),</span> <span class="n">safe</span><span class="o">=</span><span class="s2">&quot;/#:()*?=%@+,&amp;&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_image_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve relative image paths relative to the current file and output directory.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">resolve_path</span>

        <span class="c1"># if it&#39;s already an absolute URL or absolute path, return as is</span>
        <span class="k">if</span> <span class="n">image_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="s2">&quot;https://&quot;</span><span class="p">,</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_url</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

        <span class="c1"># resolve the image path relative to the current markdown file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_file_path</span><span class="p">:</span>
            <span class="n">resolved_path</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_file_path</span><span class="p">)</span>

            <span class="c1"># if the image exists, calculate the relative path from output file to image</span>
            <span class="k">if</span> <span class="n">resolved_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="c1"># use output file path if available, otherwise use output directory</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">:</span>
                    <span class="c1"># calculate relative path from output file location to image</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">relative_path</span> <span class="o">=</span> <span class="n">resolved_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">relative_path</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># fallback: use os.path.relpath for robust relative path calculation</span>
                        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

                        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resolved_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_url</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># fallback to output directory</span>
                    <span class="n">output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_file_path</span><span class="o">.</span><span class="n">parent</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">relative_path</span> <span class="o">=</span> <span class="n">resolved_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">relative_path</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resolved_path</span><span class="p">))</span>

        <span class="c1"># fallback to original path</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_url</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts the base element to HTML with full document structure.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toc_headings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">content</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="n">meta_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;meta name=</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> content=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&gt;&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">metadata</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>

        <span class="n">toc_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_toc</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_toc</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span>
</pre></div>

</div>
</div></td>
</tr>
<tr>
<td>CLI</td>
<td>babbl/cli.py</td>
<td><div class="code-reference">
<div class="code-ref-header" onclick="toggleCodeRef('code-ref-6a47be91')">
<span class="code-ref-title">../babbl/cli.py - main</span>
<span class="code-ref-toggle">▼</span>
</div>
<div class="code-ref-content" id="code-ref-6a47be91">
<div class="highlight"><pre class="code-block"><span></span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Babbl: Turn markdown into beautiful research blog posts.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div></td>
</tr>
</tbody>
</table>
</div>

</section>
</main>
</div>
<script>
function toggleCodeRef(id) {
    const content = document.getElementById(id);
    const header = content.previousElementSibling;
    const toggle = header.querySelector('.code-ref-toggle');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        toggle.textContent = '▼';
    } else {
        content.classList.add('show');
        toggle.textContent = '▲';
    }
}
</script>
</body>
</html>